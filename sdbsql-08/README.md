# Домашнее задание к занятию «Резервное копирование баз данных»


### Задание 1. Резервное копирование

### Кейс
Финансовая компания решила увеличить надёжность работы баз данных и их резервного копирования.

Необходимо описать, какие варианты резервного копирования подходят в случаях:

1.1. Необходимо восстанавливать данные в полном объёме за предыдущий день.

1.2. Необходимо восстанавливать данные за час до предполагаемой поломки.

1.3.* Возможен ли кейс, когда при поломке базы происходило моментальное переключение на работающую или починенную базу данных.

*Приведите ответ в свободной форме.*

## Ответ 1

1.1. Необходимо восстанавливать данные в полном объёме за предыдущий день.

Полное резервное копирование (Full backup);
Полное резервное копирование с дифференциальным бэкапом.
Интенсивность резервного копирования и дифференциального бэкапа зависит от требований и условий использования БД.

1.2. Необходимо восстанавливать данные за час до предполагаемой поломки.

Если данных не много и интенсивность использования низкая, то полное резервное копирование каждый день с дифференциальным бэкапом каждый час. Надежность выше, но используется больше места для хранения.
Если данных много и интенсивность использования высокая, то полное резервное копирование каждый день с инкрементным бэкапом каждый час. Этот вариант менее надежный, но использует меньше места для хранения.

1.3.* Возможен ли кейс, когда при поломке базы происходило моментальное переключение на работающую или починенную базу данных.

Возможен с помощью репликации. В случае поломки БД на Master-сервере можно назначить «новый Master-сервер» на один из Slave-серверов и перенаправить клиентов на него. После восстановления БД на Master нагрузка возвращается на него.

---

### Задание 2. PostgreSQL

2.1. С помощью официальной документации приведите пример команды резервирования данных и восстановления БД (pgdump/pgrestore).

*Приведите ответ в свободной форме.*

## Ответ 2

Команда для резервирования:
``` pg_dump sakila > sakiladb.sql ```

Команда для восстановления БД:
``` pg_restore -d sakila sakiladb.sql ```

---

### Задание 3. MySQL

3.1. С помощью официальной документации приведите пример команды инкрементного резервного копирования базы данных MySQL.

## Ответ 3

Пример для MySQL Enterprise Backup 8.4 из официальной документации:
```
mysqlbackup --defaults-file=/home/dbadmin/my.cnf --incremental \
  --incremental-base=dir:/directory/full_backup \
  --incremental-backup-dir=/directory/inc_backup \
  backup
```
Для инкрементного резервного копирования необходимо указать путь до полной копии, как основы, но можно использовать параметр --incremental-base=history:last_backup, чтобы использовать последнюю успешную копию.
